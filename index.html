<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N26 Local Demo Bank</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Helvetica Neue',Arial,sans-serif}
body{background:#f5f6fa;color:#111;overflow-x:hidden}
.hidden{display:none}
.card{background:#fff;padding:20px;margin-bottom:20px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,.08);transition:0.3s}
button{background:#0052cc;color:#fff;border:none;padding:12px;border-radius:12px;cursor:pointer;width:100%;font-weight:bold;transition:0.2s}
button:hover{background:#003c99}
input,select,textarea{width:100%;padding:12px;margin:10px 0;border-radius:12px;border:1px solid #ccc;font-size:16px}
.sidebar{position:fixed;top:0;left:-250px;width:250px;height:100%;background:#002d72;color:#fff;padding:20px;transition:.3s;z-index:100;overflow-y:auto;}
.sidebar.show{left:0}
.sidebar a{display:flex;align-items:center;color:#fff;padding:12px;margin-bottom:10px;border-radius:12px;text-decoration:none;font-weight:bold;cursor:pointer;transition:0.2s}
.sidebar a:hover{background:rgba(255,255,255,0.1)}
.sidebar a span{margin-left:10px}
.header{background:linear-gradient(90deg,#0052cc,#002d72);color:#fff;padding:15px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:50;border-bottom-left-radius:20px;border-bottom-right-radius:20px}
.profile-img{width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:10px;border:3px solid #0052cc}
.small{font-size:13px;color:#666}
h2,h3,h4{margin-bottom:10px;font-weight:600}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);display:none;z-index:50;}
@media(max-width:768px){.header{border-radius:0} .sidebar{width:200px}}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="card" style="max-width:360px;margin:100px auto;text-align:center;">
    <h2>üîê Login</h2>
    <input id="loginUser" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginMsg" style="color:red;margin-top:10px"></p>
  </div>
</div>

<!-- Overlay for mobile -->
<div id="overlay" onclick="toggleSidebar()"></div>

<!-- BANK APP -->
<div id="bankApp" class="hidden">

  <!-- Header -->
  <div id="header" class="header">
    <span onclick="toggleSidebar()" style="cursor:pointer;font-size:22px;">‚ò∞</span>
    <span id="welcomeUser"></span>
  </div>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <h3>N26 Bank</h3>
    <a onclick="showPage('dashboard')">üè¶ <span>Dashboard</span></a>
    <a onclick="showPage('kyc')">ü™™ <span>KYC</span></a>
    <a onclick="showPage('history')">üìú <span>Transaction History</span></a>
    <a id="adminLink" onclick="adminLoginPrompt()">üõ†Ô∏è <span>Admin Panel</span></a>
    <a onclick="logout()">üö™ <span>Logout</span></a>
  </div>

  <!-- Pages -->
  <div id="pagesContainer">

    <!-- Dashboard -->
    <div id="dashboard" class="page hidden">
      <div class="card" style="text-align:center;">
        <img id="profilePic" src="" class="profile-img" alt="Profile">
        <h3 id="userName"></h3>
        <p>Account #: <span id="accountNumber"></span></p>
        <h2>Balance: $<span id="balance"></span></h2>
      </div>
      <div class="card">
        <h3>Deposit / Withdraw</h3>
        <input id="amt" type="number" placeholder="Amount">
        <select id="txnType"><option value="Deposit">Deposit</option><option value="Withdraw">Withdraw</option></select>
        <button onclick="requestTransaction()">Place Transaction</button>
        <p class="small">Transactions are recorded immediately in your history.</p>
      </div>
    </div>

    <!-- KYC -->
    <div id="kyc" class="page hidden">
      <div class="card">
        <h3>KYC Verification</h3>
        <input id="kycName" placeholder="Full Name" readonly>
        <input id="kycAccount" placeholder="Account Number" readonly>
        <input type="file" id="kycPhoto" readonly>
        <button id="kycSubmitBtn" onclick="submitKYC()">Submit KYC</button>
      </div>
    </div>

    <!-- Transaction History -->
    <div id="history" class="page hidden">
      <div class="card">
        <h3>Transaction History</h3>
        <div id="txList"></div>
      </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin" class="page hidden">
      <div class="card">
        <h3>Admin Panel - Manage Users</h3>
        <input id="newUser" placeholder="Username">
        <input id="newPass" placeholder="Password">
        <button onclick="createUser()">Create User</button>
      </div>
      <div class="card">
        <h4>All Users & Their History</h4>
        <div id="allUsers"></div>
      </div>
      <div class="card">
        <h4>Fund Users</h4>
        <input id="fundUser" placeholder="Username">
        <input id="fundAmt" type="number" placeholder="Amount to add">
        <button onclick="fundUserBalance()">Fund User</button>
      </div>
      <div class="card">
        <h4>Pending Transactions</h4>
        <div id="pendingTx"></div>
      </div>
    </div>

  </div>
</div>

<script>
// INITIALIZE USERS & TRANSACTIONS
let users = JSON.parse(localStorage.getItem("users") || '{}');
if(!users.admin){
  users.admin = {password:"Admin1234!", role:"admin", balance:0, name:"Admin", account:"000001", photo:"", history:[]};
  localStorage.setItem("users", JSON.stringify(users));
}
let transactions = JSON.parse(localStorage.getItem("txs") || '[]');
let currentUser = localStorage.getItem("currentUser") || null;

// LOGIN
function login(){
  const u = document.getElementById("loginUser").value.trim();
  const p = document.getElementById("loginPass").value.trim();
  if(users[u] && users[u].password===p){
    currentUser = u;
    localStorage.setItem("currentUser", u);
    document.getElementById("loginPage").style.display = "none";
    initBankApp();
  } else {
    document.getElementById("loginMsg").innerText = "Invalid username or password!";
  }
}

// INIT BANK APP
function initBankApp(){
  document.getElementById("bankApp").classList.remove("hidden");
  document.getElementById("welcomeUser").innerText = currentUser;
  if(users[currentUser].role!=="admin") document.getElementById("adminLink").style.display="none";
  showPage("dashboard");
  updateDashboard();
  prepareKYC();
}

// SIDEBAR
function toggleSidebar(){
  const sb = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  sb.classList.toggle("show");
  overlay.style.display = sb.classList.contains("show") ? "block" : "none";
}

// NAVIGATION
function showPage(p){
  document.querySelectorAll(".page").forEach(d=>d.classList.add("hidden"));
  document.getElementById(p).classList.remove("hidden");
  // AUTO COLLAPSE SIDEBAR & HIDE OVERLAY
  document.getElementById("sidebar").classList.remove("show");
  document.getElementById("overlay").style.display = "none";
  if(p==="dashboard") updateDashboard();
  if(p==="history") loadTransactions();
  if(p==="admin") loadAdminPanel();
}

// LOGOUT
function logout(){localStorage.removeItem("currentUser");location.reload();}

// DASHBOARD
function updateDashboard(){
  const u = users[currentUser];
  document.getElementById("userName").innerText = u.name || currentUser;
  document.getElementById("accountNumber").innerText = u.account || "N/A";
  document.getElementById("balance").innerText = (u.balance||0).toFixed(2);
  document.getElementById("profilePic").src = u.photo || "https://via.placeholder.com/100";
}

// KYC
function prepareKYC(){
  const u = users[currentUser];
  const kName = document.getElementById("kycName");
  const kAcc = document.getElementById("kycAccount");
  const kPhoto = document.getElementById("kycPhoto");
  const btn = document.getElementById("kycSubmitBtn");
  if(u.name && u.account && u.photo){
    kName.value = u.name; kAcc.value = u.account; btn.style.display="none"; kPhoto.style.display="none";
  } else {
    kName.removeAttribute("readonly"); kAcc.removeAttribute("readonly"); kPhoto.removeAttribute("readonly"); btn.style.display="block"; kPhoto.style.display="block";
  }
}
function submitKYC(){
  const name = document.getElementById("kycName").value.trim();
  const account = document.getElementById("kycAccount").value.trim();
  const file = document.getElementById("kycPhoto").files[0];
  if(!name||!account){alert("Enter name and account number"); return;}
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      users[currentUser].photo = e.target.result;
      users[currentUser].name = name;
      users[currentUser].account = account;
      saveUsers();
      alert("KYC saved!");
      prepareKYC(); showPage("dashboard");
    }
    reader.readAsDataURL(file);
  } else {alert("Upload passport photo");}
}

// TRANSACTIONS
function requestTransaction(){
  const amt = parseFloat(document.getElementById("amt").value);
  const type = document.getElementById("txnType").value;
  if(isNaN(amt)||amt<=0){alert("Enter valid amount"); return;}
  const txObj = {user:currentUser,type,amount:amt,status:"pending",date:new Date().toLocaleString()};
  transactions.push(txObj);
  if(!users[currentUser].history) users[currentUser].history=[];
  users[currentUser].history.push({...txObj}); // record in user history
  saveUsers();
  localStorage.setItem("txs",JSON.stringify(transactions));
  document.getElementById("amt").value="";
  alert("Transaction recorded.");
}

// LOAD USER HISTORY WITH PENDING GREEN
function loadTransactions(){
  const txs = users[currentUser].history || [];
  document.getElementById("txList").innerHTML = txs.map(t=>{
    let statusText = "";
    if(t.status==="pending") statusText = `<span style="color:green;font-weight:bold">Pending (Contact Support)</span>`;
    else if(t.status==="approved") statusText = `<span style="color:blue;font-weight:bold">Approved</span>`;
    else if(t.status==="rejected") statusText = `<span style="color:red;font-weight:bold">Rejected</span>`;
    return `${t.type}: $${t.amount} ${statusText}<br><span class="small">${t.date}</span>`;
  }).join("<hr>");
}

// ADMIN PANEL LOGIN PROMPT
function adminLoginPrompt(){
  const uname = prompt("Admin Username:");
  const pwd = prompt("Admin Password:");
  if(uname==="admin" && pwd==="Admin1234!"){
    users[currentUser].role="admin";
    saveUsers(); showPage("admin");
  } else alert("Wrong admin credentials!");
}

// ADMIN FUNCTIONS
function createUser(){
  const u = document.getElementById("newUser").value.trim();
  const p = document.getElementById("newPass").value.trim();
  if(!u||!p){alert("Enter username and password"); return;}
  if(users[u]){alert("User exists"); return;}
  users[u]={password:p,role:"user",balance:0,name:u,account:"",photo:"",history:[]};
  saveUsers(); loadAdminPanel();
}

function fundUserBalance(){
  const u = document.getElementById("fundUser").value.trim();
  const amt = parseFloat(document.getElementById("fundAmt").value);
  if(!users[u] || isNaN(amt) || amt<=0){alert("Invalid user or amount"); return;}
  users[u].balance += amt;
  saveUsers();
  alert("Balance funded!");
}

function loadAdminPanel(){
  document.getElementById("allUsers").innerHTML = Object.keys(users).filter(u=>u!=="admin").map(u=>{
    const user = users[u];
    const txs = user.history.map(t=>{
      let st = t.status==="pending" ? "Pending" : t.status==="approved" ? "Approved" : "Rejected";
      return `${t.type} $${t.amount} (${st})`;
    }).join("<br>");
    return `<strong>${u}</strong> - P:${user.password} - $${user.balance}<br>Transactions:<br>${txs}<hr>`;
  }).join("");
  const pending = transactions.filter(t=>t.status==="pending");
  document.getElementById("pendingTx").innerHTML = pending.map((t,i)=>
    `${t.user} - ${t.type} $${t.amount} <button onclick="approveTx(${i})">‚úÖ</button> <button onclick="rejectTx(${i})">‚ùå</button>`
  ).join("<br>");
}

function approveTx(index){
  const t = transactions[index];
  if(t.type==="Withdraw" && users[t.user].balance<t.amount){alert("Insufficient balance!"); return;}
  if(t.type==="Withdraw") users[t.user].balance -= t.amount;
  else users[t.user].balance += t.amount;
  t.status="approved";
  const userTx = users[t.user].history.find(ht=>ht.date===t.date && ht.amount===t.amount && ht.type===t.type);
  if(userTx) userTx.status="approved";
  saveUsers(); localStorage.setItem("txs",JSON.stringify(transactions)); loadAdminPanel();
}

function rejectTx(index){
  const t = transactions[index];
  t.status="rejected";
  const userTx = users[t.user].history.find(ht=>ht.date===t.date && ht.amount===t.amount && ht.type===t.type);
  if(userTx) userTx.status="rejected";
  saveUsers(); localStorage.setItem("txs",JSON.stringify(transactions)); loadAdminPanel();
}

// SAVE USERS
function saveUsers(){localStorage.setItem("users",JSON.stringify(users)); updateDashboard();}

// AUTO LOGIN
if(currentUser){document.getElementById("loginPage").style.display="none"; initBankApp();}
</script>

</body>
</html>
